# Отчет + (ответы на вопросы) Крэчун Дан IA2202

## Введение
В ходе данной лабораторной работы я научился обслуживать Web серверы, работающие в контейнерах Docker, и автоматизировать задачи с помощью cron. Работа включала: настройку серверов, резервное копирование и управление логами.

## Подготовка
1.Я Установил и запустил Docker Desktop.
2. Создал структуру папок:
    - `additional`
    - `database`
    - `files`
    - `site`

#### Скачивание и настройка Wordpress:
- Скачал и распаковал CMS Wordpress в папку `site`.

#### Настройка Apache HTTP Server:
- Запустил контейнер с образом httpd, скопировал и изменил конфигурационный файл.
- Создал Dockerfile.httpd для автоматизации сборки контейнера с настройками.

#### Настройка PHP-FPM:
- Создал Dockerfile.php-fpm для контейнера PHP с необходимыми расширениями.

#### Настройка MariaDB:
- Создал Dockerfile.mariadb для контейнера с базой данных MariaDB.

### Сборка и запуск Docker Compose
- Создал файл docker-compose.yml для оркестрации контейнеров, описав три сервиса:
- httpd
- php-fpm
    - mariadb

### Настройка Cron сервиса

#### Скрипты для Cron:
- Создал скрипты для проверки статуса, резервного копирования сайта и базы данных, а также для удаления старых файлов.

#### Конфигурация Cron:
- Создал файлы crontab и environment.sh для настройки планировщика заданий.

#### Создание контейнера Cron:
- Создал Dockerfile.cron для контейнера, запускающего Cron с заданными скриптами.

#### Обновление docker-compose.yml:
- Добавил конфигурацию для сервиса cron.

### Ротация логов
- Проанализировал файл httpd.conf и убедился, что логи выводятся в стандартный поток вывода (STDOUT и STDERR).

## Запуск и тестирование
1. Собрал образы сервисов с помощью команды docker-compose build.
2. Запустил контейнеры командой docker-compose up -d.
3. Установил Wordpress через браузер, настроив соединение с базой данных.
4. Проверил логи каждого контейнера командой docker logs <>.
5. Остановил и удалил контейнеры командами docker-compose down и docker-compose rm.
6. Запустил контейнеры повторно и проверил работоспособность сайта.
7. Проверил наличие резервных копий в папках ./backups/mysql/ и ./backups/site/.

## Изменения в расписании Cron
- Отредактировал crontab для выполнения следующих задач:
- Ежедневное резервное копирование базы данных CMS в 1:00.
- Еженедельное резервное копирование директории CMS по понедельникам.
- Ежедневное удаление резервных копий старше 30 дней в 2:00.

## Заключение
В ходе выполнения данной лабораторной работы я научился:
- Настраивать и запускать Web серверы в контейнерах Docker.
- Автоматизировать резервное копирование и управление файлами с помощью Cron.
- Осуществлять сборку и оркестрацию контейнеров с помощью Docker Compose.
- Настраивать вывод логов в стандартные потоки для облегчения их сбора и анализа.

Эти навыки пригодятся мне при обслуживании и поддержке веб-серверов в более больших проектах.


Ответы на вопросы :

## Вопрос 1: Зачем необходимо создавать пользователя системы для каждого сайта?

Создание отдельного системного пользователя для каждого сайта обеспечивает несколько важных аспектов безопасности и управления:

1. Изоляция: Каждый сайт изолирован в своем собственном пространстве, что предотвращает перекрестное заражение и ограничивает влияние взлома одного сайта на другие.
2. Управление доступом: Пользовательские учетные записи позволяют более точно управлять правами доступа к файлам и директориям сайта, что повышает безопасность.
3. Учет и аудит: Отдельные учетные записи позволяют легче отслеживать и аудитировать действия, выполняемые на уровне сайта.
4. Резервное копирование и восстановление: Управление данными становится проще, так как можно выполнять резервное копирование и восстановление на уровне отдельных сайтов.

## Вопрос 2: В каких случаях Web сервер должен иметь полный доступ к папкам (папке) сайта?

Полный доступ (чтение, запись и выполнение) к папкам сайта web сервер должен иметь в следующих случаях:

1. Временные файлы и кеш: Если сайт создает временные файлы или кеш, web сервер должен иметь возможность записывать в соответствующие папки.
2. Загрузка файлов: Когда веб-приложение позволяет пользователям загружать файлы, web сервер должен иметь права на запись в директорию, куда эти файлы загружаются.
3. Обновление контента: Для CMS (систем управления контентом) или других динамических сайтов, где содержимое сайта может изменяться через админ-панель.
4. Логи и отладка: Некоторые web серверы записывают свои логи и отладочные файлы в директории сайта, для этого требуется полный доступ.

## Вопрос 3: Что означает команда `chmod -R 0755 /home/www/anydir`?

Команда `chmod -R 0755 /home/www/anydir` изменяет права доступа к файлам и директориям.

- `chmod` — команда для изменения прав доступа.
- `-R` — рекурсивное изменение прав, то есть права изменяются для всех файлов и папок внутри указанной директории.
- `0755` — устанавливает права:
- `0` — специальный режим.
- `7` — полный доступ для владельца.
- `5` — права на чтение и выполнение для группы.
- `5` — права на чтение и выполнение для остальных пользователей.

Все файлы и директории внутри `/home/www/anydir` будут иметь права:
- Владелец: чтение, запись и выполнение.
- Группа: чтение и выполнение.
- Остальные: чтение и выполнение.

## Вопрос 4: В скриптах shell каждая команда оканчивается строкой `> /proc/1/fd/1`. Что это означает?

В shell скриптах команда `> /proc/1/fd/1` перенаправляет стандартный вывод (stdout) команды в файл дескриптора 1 (stdout) процесса с PID 1.

- `/proc/1/fd/1` — это файловый дескриптор stdout процесса с PID 1, который является главным процессом системы (init или systemd).

Эта конструкция используется в Docker, для того чтобы:
- Процесс с PID 1 является основным процессом контейнера.
- Перенаправление вывода на `> /proc/1/fd/1` гарантирует, что все выходные данные команд попадут в логи основного процесса контейнера, что позволяет легче отслеживать и управлять логами в контейнерах.
- `> /proc/1/fd/1` упорядочивает логи и делает их доступными для просмотра в контексте основного процесса контейнера.
